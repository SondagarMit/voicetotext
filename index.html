<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Gujarati Voice Translator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #4CAF50;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 20px;
        }

        select,
        button,
        input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }

        button:hover {
            background-color: #45a049;
        }

        #recording-status,
        #translated-text,
        #original-text {
            margin-top: 20px;
            font-size: 14px;
            color: #333;
        }

        #recording-status {
            color: red;
        }

        .note {
            margin-top: 20px;
            font-size: 12px;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>Improved Voice Translator</h1>

    <!-- Language Selection -->
    <label for="default-lang">Default Language:</label>
    <select id="default-lang">
        <option value="gu-IN" selected>Gujarati</option>
        <option value="en-US">English (US)</option>
        <option value="hi-IN">Hindi</option>
        <option value="es-ES">Spanish</option>
        <option value="fr-FR">French</option>

    </select>

    <label for="translate-lang">Translate To:</label>
    <select id="translate-lang">
        <option value="en" selected>English</option>
        <option value="hi">Hindi</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>

    </select>
    <!-- Input field for phone number -->
    <label for="phone-number">Send To (Phone Number):</label>
    <input type="text" id="phone-number" placeholder="Enter phone number (with country code, e.g. 917878537979)" />



    <!-- Voice Recording Button -->
    <button onclick="startVoiceRecording()">Record Voice</button>
    <p id="recording-status"></p>
    <p><b>Original Voice to Text:</b> <span id="original-text"></span></p>
    <p><b>Translated Text:</b> <span id="translated-text"></span></p>


    <button onclick="sendToWhatsApp()">Send to WhatsApp</button>

    <!-- <script>

        
        // Voice recording function
        async function startVoiceRecording() {
            const recordingStatus = document.getElementById("recording-status");
            recordingStatus.textContent = "Recording... Speak now!";
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = document.getElementById("default-lang").value;

                recognition.start();

                recognition.onresult = async (event) => {
                    recordingStatus.textContent = ""; // Clear recording status
                    const originalText = event.results[0][0].transcript; // Get recognized text
                    document.getElementById("original-text").textContent = originalText; // Display original text

                    // Translate text
                    await translateText(originalText);
                };

                recognition.onerror = (event) => {
                    console.error("Speech recognition error:", event.error);
                    recordingStatus.textContent = "Error recognizing voice. Please try again.";
                };

                recognition.onend = () => {
                    if (recordingStatus.textContent === "Recording... Speak now!") {
                        recordingStatus.textContent = "Recording ended. No input detected.";
                    }
                };
            } catch (error) {
                console.error("Voice recording error:", error);
                recordingStatus.textContent = "Your browser doesn't support voice recording.";
            }
        }

        // Translate text
        async function translateText(originalText) {
            const defaultLang = document.getElementById("default-lang").value.slice(0, 2); // Extract "gu" from "gu-IN"
            const translateLang = document.getElementById("translate-lang").value;

            // Encode the text for the URL
            const encodedText = encodeURIComponent(originalText);

            try {
                const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${defaultLang}&tl=${translateLang}&dt=t&q=${encodedText}`);
                const result = await response.json();

                // Extract and display the translated text
                const translatedText = result[0][0][0];
                document.getElementById("translated-text").textContent = translatedText;

                // After translation, paste text into WhatsApp
                pasteTranslatedTextIntoWhatsApp(translatedText);
            } catch (error) {
                console.error("Translation error:", error);
                document.getElementById("translated-text").textContent = "Translation failed.";
            }
        }
    </script> -->




    <!--Above code is Working but some limitation-->
    <script>
       // let translatedText = "";
        // Voice recording function
        async function startVoiceRecording() {
            const recordingStatus = document.getElementById("recording-status");
            recordingStatus.textContent = "Recording... Speak now!";
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = document.getElementById("default-lang").value;

                recognition.start();

                recognition.onresult = async (event) => {
                    recordingStatus.textContent = ""; // Clear recording status
                    const originalText = event.results[0][0].transcript; // Get recognized text
                    document.getElementById("original-text").textContent = originalText; // Display original text

                    // Translate text
                    await translateText(originalText);
                };

                recognition.onerror = (event) => {
                    console.error("Speech recognition error:", event.error);
                    recordingStatus.textContent = "Error recognizing voice. Please try again.";
                };

                recognition.onend = () => {
                    if (recordingStatus.textContent === "Recording... Speak now!") {
                        recordingStatus.textContent = "Recording ended. No input detected.";
                    }
                };
            } catch (error) {
                console.error("Voice recording error:", error);
                recordingStatus.textContent = "Your browser doesn't support voice recording.";
            }
        }

        async function translateText(originalText) {
    const defaultLang = document.getElementById("default-lang").value.slice(0, 2); // Extract "gu" from "gu-IN"
    const translateLang = document.getElementById("translate-lang").value;

    // Encode the text for the URL
    const encodedText = encodeURIComponent(originalText);

    try {
        // Request to the Google Translate API
        const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${defaultLang}&tl=${translateLang}&dt=t&q=${encodedText}`);

        // Check if the response is successful
        if (!response.ok) {
            throw new Error(`Translation API returned an error: ${response.statusText}`);
        }

        // Parse the response
        const result = await response.json();
        console.log("Translation API response:", result);

        // Extract and display the translated text
        const translatedText = result[0][0][0];
        document.getElementById("translated-text").textContent = translatedText;

        // After translation, send translated text to WhatsApp
        pasteTextIntoWhatsApp(translatedText);
    } catch (error) {
        console.error("Translation error:", error);
        document.getElementById("translated-text").textContent = "Translation failed.";
    }
}
        // Function to send the translated text to WhatsApp
        function sendToWhatsApp() {
            // Get the phone number and translated text from the form or page
            const phoneNumber = document.getElementById("phone-number").value; // Assuming you have an input field with id 'phone-number'
            const translatedText = document.getElementById("translated-text").textContent; // Assuming translated text is displayed in an element with id 'translated-text'

            if (!phoneNumber || !translatedText) {
                alert("Please enter a valid phone number and ensure the text is translated.");
                return;
            }

            // Construct the WhatsApp message with only the translated text
            const message = encodeURIComponent(translatedText); // Only include the translated text

            // Construct the WhatsApp URL
            const whatsappURL = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${message}`;

            // Open the WhatsApp link in a new tab or window
            window.open(whatsappURL, '_blank');
        }
    </script>
</body>

</html>